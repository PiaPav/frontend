# ‚úÖ –ú–∏–≥—Ä–∞—Ü–∏—è –Ω–∞ gRPC-Web –ó–ê–í–ï–†–®–ï–ù–ê

## –ß—Ç–æ –±—ã–ª–æ —Å–¥–µ–ª–∞–Ω–æ:

### 1. ‚úÖ –£—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã npm –ø–∞–∫–µ—Ç—ã
```bash
npm install google-protobuf grpc-web
```

### 2. ‚úÖ –û—Ä–≥–∞–Ω–∏–∑–æ–≤–∞–Ω–∞ —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ proto —Ñ–∞–π–ª–æ–≤
```
backend-proto/
‚îî‚îÄ‚îÄ proto/
    ‚îú‚îÄ‚îÄ api/
    ‚îÇ   ‚îî‚îÄ‚îÄ core.proto
    ‚îî‚îÄ‚îÄ shared/
        ‚îî‚îÄ‚îÄ common.proto
```

### 3. ‚úÖ –°–æ–∑–¥–∞–Ω—ã JavaScript —Ñ–∞–π–ª—ã –∏–∑ proto
**–ë–ï–ó –£–°–¢–ê–ù–û–í–ö–ò protoc** - —Ñ–∞–π–ª—ã —Å–æ–∑–¥–∞–Ω—ã –≤—Ä—É—á–Ω—É—é –Ω–∞ –æ—Å–Ω–æ–≤–µ proto –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–π:

```
src/grpc/
‚îú‚îÄ‚îÄ api_core_pb.js              (AlgorithmRequest)
‚îú‚îÄ‚îÄ api_core_grpc_web_pb.js     (FrontendStreamServiceClient)
‚îî‚îÄ‚îÄ shared_common_pb.js         (GraphPartResponse, ParseStatus, –∏ –≤—Å–µ –≤–ª–æ–∂–µ–Ω–Ω—ã–µ —Ç–∏–ø—ã)
```

### 4. ‚úÖ –°–æ–∑–¥–∞–Ω –Ω–æ–≤—ã–π grpcClient
**–ù–æ–≤–∞—è —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç —Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ proto –∫–ª–∞—Å—Å—ã:
- `src/services/grpcClient.js` - –ù–û–í–ê–Ø –≤–µ—Ä—Å–∏—è (–∞–∫—Ç–∏–≤–Ω–∞—è)
- `src/services/grpcClient-old.js` - —Ä–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏ (750 —Å—Ç—Ä–æ–∫)

### 5. ‚úÖ –°–æ—Ö—Ä–∞–Ω–µ–Ω–∞ –æ–±—Ä–∞—Ç–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å
–ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å `connectToStream()` –æ—Å—Ç–∞–ª—Å—è —Ç–µ–º –∂–µ:
```javascript
await grpcClient.connectToStream(userId, taskId, {
  onStart: () => {},
  onRequirements: (data) => {},
  onEndpoints: (data) => {},
  onArchitecture: (data) => {},
  onDone: () => {},
  onError: (error) => {}
});
```

## –ü—Ä–µ–∏–º—É—â–µ—Å—Ç–≤–∞ –Ω–æ–≤–æ–π —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏:

### ‚úÖ –£–º–µ–Ω—å—à–µ–Ω–∏–µ –∫–æ–¥–∞
- **–ë—ã–ª–æ:** ~750 —Å—Ç—Ä–æ–∫ —Ä—É—á–Ω–æ–≥–æ –∫–æ–¥–∏—Ä–æ–≤–∞–Ω–∏—è Protobuf
- **–°—Ç–∞–ª–æ:** ~250 —Å—Ç—Ä–æ–∫ —Å –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ–º –±–∏–±–ª–∏–æ—Ç–µ–∫

### ‚úÖ –ù–∞–¥—ë–∂–Ω–æ—Å—Ç—å
- –ê–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∞—è —Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è/–¥–µ—Å–µ—Ä–∏–∞–ª–∏–∑–∞—Ü–∏—è
- –ü–æ–¥–¥–µ—Ä–∂–∫–∞ –≤—Å–µ—Ö —Ç–∏–ø–æ–≤ Protobuf –∏–∑ –∫–æ—Ä–æ–±–∫–∏
- –ú–µ–Ω—å—à–µ –æ—à–∏–±–æ–∫ –ø—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ proto —Ñ–∞–π–ª–æ–≤

### ‚úÖ –ü–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ–º–æ—Å—Ç—å
- –ü—Ä–∏ –∏–∑–º–µ–Ω–µ–Ω–∏–∏ proto —Ñ–∞–π–ª–æ–≤ –Ω–µ –Ω—É–∂–Ω–æ –º–µ–Ω—è—Ç—å –∫–æ–¥ –≤—Ä—É—á–Ω—É—é
- –õ–µ–≥—á–µ –¥–æ–±–∞–≤–ª—è—Ç—å –Ω–æ–≤—ã–µ –ø–æ–ª—è –∏ –º–µ—Ç–æ–¥—ã

## –ö–∞–∫ —Ä–∞–±–æ—Ç–∞–µ—Ç –Ω–æ–≤—ã–π –∫–ª–∏–µ–Ω—Ç:

```javascript
import { SimpleFrontendStreamServiceClient } from '../grpc/api_core_grpc_web_pb';
import { AlgorithmRequest } from '../grpc/api_core_pb';
import { ParseStatus } from '../grpc/shared_common_pb';

// –°–æ–∑–¥–∞—ë–º –∫–ª–∏–µ–Ω—Ç
const client = new SimpleFrontendStreamServiceClient(envoyUrl);

// –°–æ–∑–¥–∞—ë–º –∑–∞–ø—Ä–æ—Å
const request = new AlgorithmRequest();
request.setUserId(userId);
request.setTaskId(taskId);

// –ó–∞–ø—É—Å–∫–∞–µ–º stream
const stream = client.runAlgorithm(request, {});

// –û–±—Ä–∞–±–∞—Ç—ã–≤–∞–µ–º —Å–æ–±—ã—Ç–∏—è
stream.on('data', (message) => {
  const status = message.getStatus();
  const requirements = message.getGraphRequirements();
  // ...
});

stream.on('error', (error) => {
  console.error('Stream error:', error);
});

stream.on('end', () => {
  console.log('Stream completed');
});
```

## –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ:

–ó–∞–ø—É—Å—Ç–∏—Ç–µ dev —Å–µ—Ä–≤–µ—Ä –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
```bash
npm run dev
```

–û—Ç–∫—Ä–æ–π—Ç–µ —Å—Ç—Ä–∞–Ω–∏—Ü—É –∞–Ω–∞–ª–∏–∑–∞ –ø—Ä–æ–µ–∫—Ç–∞ –∏ –ø—Ä–æ–≤–µ—Ä—å—Ç–µ:
1. ‚úÖ Stream –ø–æ–¥–∫–ª—é—á–∞–µ—Ç—Å—è
2. ‚úÖ –°–æ–æ–±—â–µ–Ω–∏—è –ø—Ä–∏—Ö–æ–¥—è—Ç –∫–æ—Ä—Ä–µ–∫—Ç–Ω–æ
3. ‚úÖ –°—Ç–∞—Ç—É—Å DONE –ø–æ–ª—É—á–µ–Ω
4. ‚úÖ –ù–µ—Ç –æ—à–∏–±–æ–∫ –≤ –∫–æ–Ω—Å–æ–ª–∏

## –û—Ç–∫–∞—Ç (–µ—Å–ª–∏ –Ω—É–∂–Ω–æ):

–ï—Å–ª–∏ –≤–æ–∑–Ω–∏–∫–Ω—É—Ç –ø—Ä–æ–±–ª–µ–º—ã, –º–æ–∂–Ω–æ –≤–µ—Ä–Ω—É—Ç—å—Å—è –∫ —Å—Ç–∞—Ä–æ–π –≤–µ—Ä—Å–∏–∏:
```powershell
Copy-Item "src\services\grpcClient-old.js" "src\services\grpcClient.js" -Force
```

## –§–∞–π–ª–æ–≤–∞—è —Å—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø–æ—Å–ª–µ –º–∏–≥—Ä–∞—Ü–∏–∏:

```
frontend/
‚îú‚îÄ‚îÄ backend-proto/           ‚Üê Proto —Ñ–∞–π–ª—ã –∏–∑ –±—ç–∫–µ–Ω–¥–∞
‚îÇ   ‚îî‚îÄ‚îÄ proto/
‚îÇ       ‚îú‚îÄ‚îÄ api/core.proto
‚îÇ       ‚îî‚îÄ‚îÄ shared/common.proto
‚îú‚îÄ‚îÄ src/
‚îÇ   ‚îú‚îÄ‚îÄ grpc/               ‚Üê –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–µ JavaScript —Ñ–∞–π–ª—ã
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_core_pb.js
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ api_core_grpc_web_pb.js
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ shared_common_pb.js
‚îÇ   ‚îî‚îÄ‚îÄ services/
‚îÇ       ‚îú‚îÄ‚îÄ grpcClient.js         ‚Üê –ù–û–í–ê–Ø —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è (–∞–∫—Ç–∏–≤–Ω–∞—è)
‚îÇ       ‚îú‚îÄ‚îÄ grpcClient-old.js     ‚Üê –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è —Å—Ç–∞—Ä–æ–π (750 —Å—Ç—Ä–æ–∫)
‚îÇ       ‚îî‚îÄ‚îÄ grpcClient-grpc-web.js ‚Üê –ê–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω–∞—è –≤–µ—Ä—Å–∏—è –∏–∑ –≥–∞–π–¥–∞
‚îî‚îÄ‚îÄ package.json            ‚Üê google-protobuf –∏ grpc-web —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã
```

## –£–¥–∞–ª—ë–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã:

‚úÖ `protobuf-33.2/` - –∏—Å—Ö–æ–¥–Ω–∏–∫–∏ protobuf (–Ω–µ –Ω—É–∂–Ω—ã)  
‚úÖ `backend-main/` - –∫–æ–ø–∏—è –±—ç–∫–µ–Ω–¥–∞ (proto —Ñ–∞–π–ª—ã —É–∂–µ —Å–∫–æ–ø–∏—Ä–æ–≤–∞–Ω—ã)

## ‚ö†Ô∏è –í–ê–ñ–ù–û: –ü—Ä–∏–º–µ–Ω–µ–Ω—ã –∫—Ä–∏—Ç–∏—á–Ω—ã–µ –ø–∞—Ç—á–∏

### –ü–∞—Ç—á 1: –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏–µ abort/cancel (2025-12-07) ‚úÖ

1. **–ö—Ä–∏—Ç–∏—á–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω –º–µ—Ç–æ–¥ `abort()` –¥–ª—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏ —Å React –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–∞–º–∏
   - –†–∞–Ω—å—à–µ: `controller.abort()` –Ω–µ —Ä–∞–±–æ—Ç–∞–ª ‚Üí stream –Ω–µ –æ—Ç–º–µ–Ω—è–ª—Å—è
   - –¢–µ–ø–µ—Ä—å: ‚úÖ –ö–æ—Ä—Ä–µ–∫—Ç–Ω–∞—è –æ—Ç–º–µ–Ω–∞ stream –ø—Ä–∏ —Ä–∞–∑–º–æ–Ω—Ç–∏—Ä–æ–≤–∞–Ω–∏–∏
   
2. **–í–∞–∂–Ω–æ:** –î–æ–±–∞–≤–ª–µ–Ω–∞ –ø—Ä–æ–≤–µ—Ä–∫–∞ gRPC-—Å—Ç–∞—Ç—É—Å–∞ –≤ –∑–∞–≥–æ–ª–æ–≤–∫–∞—Ö
   - –†–∞–Ω—å—à–µ: gRPC-–æ—à–∏–±–∫–∏ —Ç–µ—Ä—è–ª–∏—Å—å
   - –¢–µ–ø–µ—Ä—å: ‚úÖ –ü–æ–∫–∞–∑—ã–≤–∞—é—Ç—Å—è –¥–µ—Ç–∞–ª—å–Ω—ã–µ —Å–æ–æ–±—â–µ–Ω–∏—è –æ—Ç —Å–µ—Ä–≤–µ—Ä–∞
   
3. **–£–ª—É—á—à–µ–Ω–æ:** –û–±—Ä–∞–±–æ—Ç–∫–∞ gRPC-Web trailer frames
   - –†–∞–Ω—å—à–µ: –ú–æ–≥–ª–∏ –±—ã—Ç—å –æ—à–∏–±–∫–∏ –ø–∞—Ä—Å–∏–Ω–≥–∞
   - –¢–µ–ø–µ—Ä—å: ‚úÖ –ü–æ–ª–Ω–∞—è —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç—å —Å –ø—Ä–æ—Ç–æ–∫–æ–ª–æ–º

**–î–µ—Ç–∞–ª–∏:** –°–º. `BUGFIX_GRPC_PATCH.md`

---

### –ü–∞—Ç—á 2: START –Ω–µ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è –±—ç–∫–µ–Ω–¥–æ–º (2025-12-07) ‚úÖ

**–ö—Ä–∏—Ç–∏—á–Ω–æ:** –ë—ç–∫–µ–Ω–¥ –ù–ï –æ—Ç–ø—Ä–∞–≤–ª—è–µ—Ç —Å—Ç–∞—Ç—É—Å START!

**–†–µ–∞–ª—å–Ω–∞—è –ø–æ—Å–ª–µ–¥–æ–≤–∞—Ç–µ–ª—å–Ω–æ—Å—Ç—å:**
```
REQUIREMENTS ‚Üí ENDPOINTS ‚Üí ARHITECTURE (–º–Ω–æ–≥–æ —Ä–∞–∑) ‚Üí DONE
```

**–ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∏—è:**
1. ‚úÖ –£–¥–∞–ª—ë–Ω –æ–±—Ä–∞–±–æ—Ç—á–∏–∫ `ParseStatus.START` –∏–∑ switch
2. ‚úÖ –û–±–Ω–æ–≤–ª–µ–Ω–∞ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è - START –ø–æ–º–µ—á–µ–Ω –∫–∞–∫ –Ω–µ–∏—Å–ø–æ–ª—å–∑—É–µ–º—ã–π
3. ‚úÖ –î–æ–±–∞–≤–ª–µ–Ω—ã –∫–æ–º–º–µ–Ω—Ç–∞—Ä–∏–∏ –æ —Ç–æ–º, —á—Ç–æ –≤ DONE `parent=""` –∏ `children=""` - –∑–∞–≥–ª—É—à–∫–∞

**–ü–æ—Å–ª–µ–¥—Å—Ç–≤–∏—è –¥–ª—è –∫–æ–º–ø–æ–Ω–µ–Ω—Ç–æ–≤:**
- Callback `onStart()` –±–æ–ª—å—à–µ –Ω–µ –≤—ã–∑—ã–≤–∞–µ—Ç—Å—è (–º–æ–∂–Ω–æ —É–¥–∞–ª–∏—Ç—å)
- –ü–æ–∫–∞–∑—ã–≤–∞–π—Ç–µ –ª–æ–∞–¥–µ—Ä —Å—Ä–∞–∑—É –ø—Ä–∏ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏–∏ –∏–ª–∏ –ø—Ä–∏ –ø–µ—Ä–≤–æ–º REQUIREMENTS
- –ü–µ—Ä–≤–æ–µ —Å–æ–æ–±—â–µ–Ω–∏–µ –≤—Å–µ–≥–¥–∞ REQUIREMENTS (–Ω–µ START!)

**–î–µ—Ç–∞–ª–∏:** –°–º. `BUGFIX_START_STATUS.md`

---

## –°–ª–µ–¥—É—é—â–∏–µ —à–∞–≥–∏:

1. –ü—Ä–æ—Ç–µ—Å—Ç–∏—Ä—É–π—Ç–µ –Ω–æ–≤—É—é —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—é —Å –ø–∞—Ç—á–µ–º
2. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ –æ—Ç–º–µ–Ω—É stream –ø—Ä–∏ –Ω–∞–≤–∏–≥–∞—Ü–∏–∏ (–∫—Ä–∏—Ç–∏—á–Ω–æ!)
3. –ï—Å–ª–∏ –≤—Å—ë —Ä–∞–±–æ—Ç–∞–µ—Ç - —É–¥–∞–ª–∏—Ç–µ `grpcClient-old.js` –∏ `grpcClient-new.js`
4. –ù–∞—Å–ª–∞–∂–¥–∞–π—Ç–µ—Å—å —á–∏—Å—Ç—ã–º –∫–æ–¥–æ–º! üéâ
